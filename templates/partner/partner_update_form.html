{% extends "base.html" %}
{% load static %}

{% block title %}Edytuj partnera: {{ partner.name }} | XManager{% endblock %}

{% block page_title %}Edytuj partnera: {{ partner.name }}{% endblock %}

{% block page_actions %}
    <a href="{% url 'partner:partner_list' %}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-1"></i> Powrót do listy
    </a>
{% endblock %}

{% block content %}
    <div class="card">
        <div class="card-body">
            <form method="post" action="{% url 'partner:partner_update' partner.pk %}" id="partnerForm">
                {% csrf_token %}
                
                {% if form.errors %}
                <div class="alert alert-danger">
                    <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Błędy formularza:</h5>
                    <ul class="mb-0">
                        {% for field, errors in form.errors.items %}
                            {% for error in errors %}
                                <li>{{ field }}: {{ error }}</li>
                            {% endfor %}
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                <!-- Tabs for form sections -->
                <ul class="nav nav-tabs mb-3" id="partnerFormTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="main-data-tab" data-bs-toggle="tab" data-bs-target="#main-data" type="button" role="tab" aria-controls="main-data" aria-selected="true">
                            <i class="fas fa-info-circle me-1"></i> Dane podstawowe
                        </button>
                    </li>
                       <li class="nav-item" role="presentation">
                        <button class="nav-link" id="contacts-tab" data-bs-toggle="tab" data-bs-target="#contacts" type="button" role="tab" aria-controls="contacts" aria-selected="false">
                            <i class="fas fa-envelope me-1"></i> Powiązani Subskrybenci
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="vat-status-tab" data-bs-toggle="tab" data-bs-target="#vat-status" type="button" role="tab" aria-controls="vat-status" aria-selected="false">
                            <i class="fas fa-check-circle me-1"></i> Status VAT
                        </button>
                    </li>
                </ul>
                
                <!-- Tab content -->
                <div class="tab-content" id="partnerFormTabContent">
                    <!-- Main data tab -->
                    <div class="tab-pane fade show active" id="main-data" role="tabpanel" aria-labelledby="main-data-tab">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="{{ form.country.id_for_label }}" class="form-label">Kraj</label>
                                <div class="dropdown">
                                    <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="countryDropdownButton" data-bs-toggle="dropdown" aria-expanded="false">
                                        {% for code, name in countries %}
                                            {% if code == form.country.value %}{{ name }}{% endif %}
                                        {% endfor %}
                                    </button>
                                    <input type="hidden" name="country" id="{{ form.country.id_for_label }}" value="{{ form.country.value }}" required>
                                    <ul class="dropdown-menu country-dropdown-menu w-100" aria-labelledby="countryDropdownButton" style="max-height: 300px; overflow-y: auto;">
                                        <li class="px-2 mb-2">
                                            <input type="text" class="form-control form-control-sm" id="countrySearchInput" placeholder="Szukaj...">
                                        </li>
                                        <div class="country-items">
                                            {% for code, name in countries %}
                                                <li><a class="dropdown-item country-item" href="#" data-code="{{ code }}">{{ name }}</a></li>
                                            {% endfor %}
                                        </div>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="{{ form.vat_number.id_for_label }}" class="form-label">Numer VAT</label>
                                <div class="input-group">
                                    <span class="input-group-text country-prefix">{{ form.country.value }}</span>
                                    <input type="text" name="vat_number" id="{{ form.vat_number.id_for_label }}" class="form-control" value="{{ form.vat_number.value }}" placeholder="Wprowadź numer VAT (bez prefiksu kraju)" required>
                                    
                                    <a href="{% url 'partner:verify_vat' partner.pk %}" class="btn btn-primary" id="verifyVATBtn">
                                        <i class="fas fa-sync-alt me-1"></i> Weryfikuj
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="{{ form.name.id_for_label }}" class="form-label">Nazwa firmy</label>
                                <input type="text" name="name" id="{{ form.name.id_for_label }}" class="form-control" value="{{ form.name.value|default:'' }}" required>
                            </div>
                            <div class="col-md-4">
                                <label for="{{ form.phone_number.id_for_label }}" class="form-label">Numer telefonu</label>
                                <input type="text" name="phone_number" id="{{ form.phone_number.id_for_label }}" class="form-control" value="{{ form.phone_number.value|default:'' }}">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="{{ form.street_name.id_for_label }}" class="form-label">Ulica</label>
                                <input type="text" name="street_name" id="{{ form.street_name.id_for_label }}" class="form-control" value="{{ form.street_name.value|default:'' }}">
                            </div>
                            <div class="col-md-3">
                                <label for="{{ form.building_number.id_for_label }}" class="form-label">Nr budynku</label>
                                <input type="text" name="building_number" id="{{ form.building_number.id_for_label }}" class="form-control" value="{{ form.building_number.value|default:'' }}">
                            </div>
                            <div class="col-md-3">
                                <label for="{{ form.apartment_number.id_for_label }}" class="form-label">Nr lokalu</label>
                                <input type="text" name="apartment_number" id="{{ form.apartment_number.id_for_label }}" class="form-control" value="{{ form.apartment_number.value|default:'' }}">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="{{ form.postal_code.id_for_label }}" class="form-label">Kod pocztowy</label>
                                <input type="text" name="postal_code" id="{{ form.postal_code.id_for_label }}" class="form-control" value="{{ form.postal_code.value|default:'' }}">
                            </div>
                            <div class="col-md-6">
                                <label for="{{ form.city.id_for_label }}" class="form-label">Miasto</label>
                                <input type="text" name="city" id="{{ form.city.id_for_label }}" class="form-control" value="{{ form.city.value|default:'' }}">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="{{ form.additional_info.id_for_label }}" class="form-label">Dodatkowe informacje</label>
                                <textarea name="additional_info" id="{{ form.additional_info.id_for_label }}" class="form-control" rows="3">{{ form.additional_info.value|default:'' }}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Powiązani Subskrybenci tab -->
                    <div class="tab-pane fade" id="contacts" role="tabpanel" aria-labelledby="contacts-tab">
                        <div class="mb-4">
                            <h5 class="mb-3">Powiązani subskrybenci (maksymalnie 10)</h5>
                            
                            <!-- Obecnie powiązani subskrybenci -->
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>Obecnie powiązani</span>
                                        <span class="badge bg-primary" id="subscriberCount">{{ form.email_contacts.value|length }}</span>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <ul class="list-group list-group-flush" id="linkedSubscribersList">
                                        {% for subscriber in form.email_contacts.value %}
                                        <li class="list-group-item d-flex justify-content-between align-items-center" data-subscriber-id="{{ subscriber.id }}">
                                            <div>
                                                <strong>{{ subscriber.email }}</strong>
                                                {% if subscriber.first_name or subscriber.last_name %}
                                                <br><small class="text-muted">{{ subscriber.first_name }} {{ subscriber.last_name }}</small>
                                                {% endif %}
                                            </div>
                                            <button type="button" class="btn btn-sm btn-outline-danger remove-subscriber-btn" data-subscriber-id="{{ subscriber.id }}">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </li>
                                        {% empty %}
                                        <li class="list-group-item text-center text-muted" id="noSubscribersMessage">
                                            Brak powiązanych subskrybentów
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Ukryte pole przechowujące ID wybranych subskrybentów -->
                            <div id="subscriberIdsContainer">
                                {% for subscriber in form.email_contacts.value %}
                                <input type="hidden" name="email_contacts" value="{{ subscriber.id }}" class="subscriber-id-input" data-subscriber-id="{{ subscriber.id }}">
                                {% endfor %}
                            </div>
                            
                            <!-- Wyszukiwarka subskrybentów -->
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Wyszukaj i dodaj subskrybenta</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="input-group">
                                            <input type="text" id="subscriberSearchInput" class="form-control" placeholder="Wyszukaj po adresie email, imieniu lub nazwisku...">
                                            <button type="button" id="searchSubscriberBtn" class="btn btn-primary">
                                                <i class="fas fa-search"></i> Szukaj
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div id="searchResults" class="mt-3 d-none">
                                        <h6 class="mb-2">Wyniki wyszukiwania:</h6>
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Email</th>
                                                        <th>Imię</th>
                                                        <th>Nazwisko</th>
                                                        <th>Akcja</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="searchResultsBody">
                                                    <!-- Wyniki wyszukiwania będą dodawane tutaj przez JavaScript -->
                                                </tbody>
                                            </table>
                                        </div>
                                        <div id="noSearchResultsMessage" class="alert alert-info d-none">
                                            <i class="fas fa-info-circle me-2"></i> Nie znaleziono subskrybentów pasujących do kryteriów wyszukiwania.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- VAT Status tab (only for edit) -->
                    <div class="tab-pane fade" id="vat-status" role="tabpanel" aria-labelledby="vat-status-tab">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="card border-0 bg-light">
                                    <div class="card-body">
                                        <h6 class="card-subtitle mb-2">Status weryfikacji</h6>
                                        <div class="d-flex align-items-center mb-2">
                                            <span class="me-2">Status:</span>
                                            {% if partner.is_verified %}
                                                <span class="badge bg-success">Aktywny</span>
                                            {% else %}
                                                <span class="badge bg-warning">Nieaktywny</span>
                                            {% endif %}
                                        </div>
                                        <p class="mb-1">
                                            <strong>Numer VAT:</strong><br>
                                            {{ partner.get_full_vat_number }}
                                        </p>
                                        <p class="mb-1">
                                            <strong>Data weryfikacji:</strong><br>
                                            {% if partner.verification_date %}
                                                {{ partner.verification_date|date:"d.m.Y H:i" }}
                                            {% else %}
                                                <span class="text-muted">Brak danych</span>
                                            {% endif %}
                                        </p>
                                        <p class="mb-1">
                                            <strong>ID weryfikacji:</strong><br>
                                            {% if partner.verification_id %}
                                                <code class="small">{{ partner.verification_id }}</code>
                                            {% else %}
                                                <span class="text-muted">Brak danych</span>
                                            {% endif %}
                                        </p>
                                        
                                        <div class="mt-3">
                                            <a href="{% url 'partner:verify_vat' partner.pk %}" class="btn btn-sm btn-primary w-100">
                                                <i class="fas fa-sync-alt me-1"></i> Weryfikuj ponownie
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <h6 class="mb-3">Historia weryfikacji</h6>
                                {% if verification_history %}
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Status</th>
                                                <th>ID weryfikacji</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for entry in verification_history %}
                                            <tr>
                                                <td>{{ entry.verification_date|date:"d.m.Y H:i" }}</td>
                                                <td>
                                                    {% if entry.is_verified %}
                                                    <span class="badge bg-success">Aktywny</span>
                                                    {% else %}
                                                    <span class="badge bg-warning">Nieaktywny</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if entry.verification_id %}
                                                    <code class="small">{{ entry.verification_id|truncatechars:20 }}</code>
                                                    {% else %}
                                                    <span class="text-muted">-</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% else %}
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i> Brak historii weryfikacji.
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Form buttons -->
                <div class="d-flex mt-4 border-top pt-3 justify-content-between">
                    <a href="{% url 'partner:partner_list' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-times me-1"></i> Anuluj
                    </a>
                    
                    <div>
                        <button type="button" class="btn btn-outline-danger me-2" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal">
                            <i class="fas fa-trash me-1"></i> Usuń
                        </button>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i> Zapisz zmiany
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Delete confirmation modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteConfirmModalLabel">Potwierdzenie usunięcia</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-0">Czy na pewno chcesz usunąć firmę <strong>{{ partner.name }}</strong>?</p>
                    <p class="text-danger mb-0">Tej operacji nie można cofnąć.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                    <form action="{% url 'partner:partner_delete' partner.pk %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">Usuń</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Country dropdown functionality
    const countryDropdown = document.getElementById('countryDropdownButton');
    const countryInput = document.getElementById('{{ form.country.id_for_label }}');
    const countrySearchInput = document.getElementById('countrySearchInput');
    const countryItems = document.querySelectorAll('.country-item');
    
    // Set initial country prefix
    $('.country-prefix').text(countryInput.value || '--');

    // Filter countries when searching
    countrySearchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        
        countryItems.forEach(item => {
            const text = item.textContent.toLowerCase();
            if (text.includes(searchTerm)) {
                item.parentElement.style.display = '';
            } else {
                item.parentElement.style.display = 'none';
            }
        });
    });
    
    // Handle country selection
    countryItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const code = this.getAttribute('data-code');
            const name = this.textContent;
            
            // Update hidden input and dropdown button text
            countryInput.value = code;
            countryDropdown.textContent = name;
            
            // Update country prefix for VAT number
            $('.country-prefix').text(code || '--');
            
            // Hide dropdown
            const dropdownInstance = bootstrap.Dropdown.getInstance(countryDropdown);
            if (dropdownInstance) {
                dropdownInstance.hide();
            }
        });
    });
    
    // Clear search when dropdown is closed
    document.querySelector('.dropdown').addEventListener('hidden.bs.dropdown', function() {
        countrySearchInput.value = '';
        countryItems.forEach(item => {
            item.parentElement.style.display = '';
        });
    });
    
    // Form validation before submit
    $('#partnerForm').on('submit', function(e) {
        const subscriberInputs = $('.subscriber-id-input');
        
        if (subscriberInputs.length > 10) {
            e.preventDefault();
            alert('Możesz wybrać maksymalnie 10 adresów email.');
            
            // Switch to the contacts tab
            $('#contacts-tab').tab('show');
            return false;
        }
        
        return true;
    });
    
    // Activate first tab on page load
    document.querySelector('#partnerFormTabs button[data-bs-toggle="tab"]').click();
    
    // Inicjalizacja obsługi subskrybentów
    initSubscriberHandler();
});

// Funkcje do obsługi powiązanych subskrybentów
function initSubscriberHandler() {
    // Obsługa wyszukiwania subskrybentów
    $('#searchSubscriberBtn').on('click', function() {
        const searchTerm = $('#subscriberSearchInput').val().trim();
        if (!searchTerm) return;
        
        // Zmień wygląd przycisku i zablokuj go podczas wyszukiwania
        const originalButtonText = $(this).html();
        $(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Wyszukiwanie...');
        $(this).prop('disabled', true);
        
        // Ukryj poprzednie wyniki wyszukiwania
        $('#searchResults').removeClass('d-none');
        $('#noSearchResultsMessage').addClass('d-none');
        
        // Wyświetl loader
        $('#searchResultsBody').html('<tr><td colspan="4" class="text-center"><div class="spinner-border spinner-border-sm text-primary" role="status"></div> Wyszukiwanie...</td></tr>');
        
        // Wykonaj wyszukiwanie
        $.ajax({
            url: '/partner/api/subscribers/lookup/',
            type: 'GET',
            data: { search: searchTerm },
            success: function(response) {
                const results = response.results || [];
                $('#searchResultsBody').empty();
                
                // Przywróć wygląd przycisku
                $('#searchSubscriberBtn').html(originalButtonText);
                $('#searchSubscriberBtn').prop('disabled', false);
                
                // Jeśli nie ma wyników
                if (results.length === 0) {
                    $('#noSearchResultsMessage').removeClass('d-none');
                    return;
                }
                
                // Pobierz ID aktualnie powiązanych subskrybentów
                const linkedIds = $('.subscriber-id-input').map(function() {
                    return $(this).val();
                }).get();
                
                // Wyświetl wyniki
                results.forEach(function(subscriber) {
                    const isLinked = linkedIds.includes(subscriber.id.toString());
                    const row = `
                        <tr>
                            <td>${subscriber.email}</td>
                            <td>${subscriber.first_name || '-'}</td>
                            <td>${subscriber.last_name || '-'}</td>
                            <td>
                                <button type="button" class="btn btn-sm ${isLinked ? 'btn-secondary disabled' : 'btn-primary'} add-subscriber-btn" 
                                    data-subscriber-id="${subscriber.id}" 
                                    data-subscriber-email="${subscriber.email}"
                                    data-subscriber-fname="${subscriber.first_name || ''}"
                                    data-subscriber-lname="${subscriber.last_name || ''}"
                                    ${isLinked ? 'disabled' : ''}>
                                    ${isLinked ? 'Już dodany' : 'Dodaj'}
                                </button>
                            </td>
                        </tr>
                    `;
                    $('#searchResultsBody').append(row);
                });
                
                // Dodaj obsługę przycisku dodawania
                $('.add-subscriber-btn').on('click', addSubscriber);
            },
            error: function() {
                // Przywróć wygląd przycisku
                $('#searchSubscriberBtn').html(originalButtonText);
                $('#searchSubscriberBtn').prop('disabled', false);
                
                $('#searchResultsBody').html('<tr><td colspan="4" class="text-center text-danger">Wystąpił błąd podczas wyszukiwania.</td></tr>');
            }
        });
    });
    
    // Enter w polu wyszukiwania uruchamia wyszukiwanie
    $('#subscriberSearchInput').on('keypress', function(e) {
        if (e.which === 13) {
            e.preventDefault();
            $('#searchSubscriberBtn').click();
        }
    });
    
    // Obsługa usuwania subskrybenta
    $(document).on('click', '.remove-subscriber-btn', function() {
        const subscriberId = $(this).data('subscriber-id');
        
        // Usuń element z listy
        $(`#linkedSubscribersList li[data-subscriber-id="${subscriberId}"]`).remove();
        
        // Usuń ukryte pole
        $(`.subscriber-id-input[data-subscriber-id="${subscriberId}"]`).remove();
        
        // Aktualizuj licznik
        updateSubscriberCount();
        
        // Jeśli nie ma już powiązanych subskrybentów, pokaż komunikat
        if ($('#linkedSubscribersList li').length === 0) {
            $('#linkedSubscribersList').append('<li class="list-group-item text-center text-muted" id="noSubscribersMessage">Brak powiązanych subskrybentów</li>');
        }
        
        // Aktualizuj przyciski w wynikach wyszukiwania, jeśli są widoczne
        if ($('#searchResults').is(':visible')) {
            const searchButton = $(`.add-subscriber-btn[data-subscriber-id="${subscriberId}"]`);
            if (searchButton.length) {
                searchButton.removeClass('btn-secondary disabled')
                           .addClass('btn-primary')
                           .text('Dodaj')
                           .prop('disabled', false);
            }
        }
    });
    
    // Inicjalizacja licznika przy starcie
    updateSubscriberCount();
}

// Funkcja dodająca subskrybenta do listy
function addSubscriber() {
    const btn = $(this);
    const id = btn.data('subscriber-id');
    const email = btn.data('subscriber-email');
    const firstName = btn.data('subscriber-fname');
    const lastName = btn.data('subscriber-lname');
    
    // Sprawdź limit 10 subskrybentów
    if ($('.subscriber-id-input').length >= 10) {
        alert('Możesz powiązać maksymalnie 10 subskrybentów.');
        return;
    }
    
    // Usuń komunikat "brak powiązanych" jeśli istnieje
    $('#noSubscribersMessage').remove();
    
    // Dodaj do listy
    const subscriberItem = `
        <li class="list-group-item d-flex justify-content-between align-items-center" data-subscriber-id="${id}">
            <div>
                <strong>${email}</strong>
                ${(firstName || lastName) ? `<br><small class="text-muted">${firstName} ${lastName}</small>` : ''}
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger remove-subscriber-btn" data-subscriber-id="${id}">
                <i class="fas fa-times"></i>
            </button>
        </li>
    `;
    $('#linkedSubscribersList').append(subscriberItem);
    
    // Dodaj ukryte pole z ID
    $('#subscriberIdsContainer').append(`<input type="hidden" name="email_contacts" value="${id}" class="subscriber-id-input" data-subscriber-id="${id}">`);
    
    // Deaktywuj przycisk
    btn.removeClass('btn-primary').addClass('btn-secondary disabled').text('Już dodany').prop('disabled', true);
    
    // Animacja przewijania do nowo dodanego elementu
    const newItem = $('#linkedSubscribersList li').last();
    $('#linkedSubscribersList').animate({
        scrollTop: newItem.offset().top - $('#linkedSubscribersList').offset().top + $('#linkedSubscribersList').scrollTop()
    }, 500);
    
    // Podświetl nowo dodany element na krótko
    newItem.addClass('bg-light');
    setTimeout(() => {
        newItem.removeClass('bg-light');
    }, 1500);
    
    // Aktualizuj licznik
    updateSubscriberCount();
}

// Aktualizacja licznika subskrybentów
function updateSubscriberCount() {
    const count = $('.subscriber-id-input').length;
    $('#subscriberCount').text(count);
    
    // Wyróżnij licznik na czerwono, jeśli przekroczono limit
    if (count > 10) {
        $('#subscriberCount').addClass('text-danger');
    } else {
        $('#subscriberCount').removeClass('text-danger');
    }
}
</script>

<style>
/* Custom styles for the partner edit page */
.country-dropdown-menu {
    max-height: 300px;
    overflow-y: auto;
}

.country-items {
    max-height: 250px;
    overflow-y: auto;
}

/* Style dla listy subskrybentów */
#linkedSubscribersList {
    max-height: 300px;
    overflow-y: auto;
    transition: background-color 0.3s ease;
}

/* Animacja podświetlenia dla nowo dodanych elementów */
.bg-light {
    transition: background-color 1.5s ease;
}

/* Wyszukiwarka subskrybentów - tabela wyników */
#searchResults .table {
    border: 1px solid #dee2e6;
}

#searchResults .table th {
    background-color: #f8f9fa;
}

/* Responsywność dla małych ekranów */
@media (max-width: 768px) {
    .btn-sm {
        padding: 0.25rem 0.4rem;
        font-size: 0.75rem;
    }
    
    #linkedSubscribersList .list-group-item {
        padding: 0.5rem;
    }
}
</style>
{% endblock %}